#!/bin/bash
set -e

LATEST_VERSION_ARG="${LATEST_VERSION_10:-${LATEST_VERSION:-}}"

if [ -z "${LATEST_VERSION_ARG}" ]; then
  exit 0
fi

if [ -z "${SOURCE_BRANCH:-}" ]; then
  exit 0
fi

if [ "${SOURCE_BRANCH}" != "${LATEST_VERSION_ARG}" ]; then
  exit 0
fi

IMAGE_REPO="${IMAGE_NAME%:*}"

docker tag "${IMAGE_NAME}" "${IMAGE_REPO}:10.0"
docker tag "${IMAGE_NAME}" "${IMAGE_REPO}:latest"
docker push "${IMAGE_REPO}:10.0"
docker push "${IMAGE_REPO}:latest"
